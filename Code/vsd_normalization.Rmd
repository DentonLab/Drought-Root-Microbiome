---
Variance stabilizing transformation 
---

This script normalizes the OTU table using the vst approach implemented in DESeq2. We need this normalized values to run all the beta-diversity analysis.

This script requires the files generated by the following scripts:
OTU_filtering.Rmd 

Load the library
```{r}
library(DESeq2)
```

Load data and format
```{r}
otu <- readRDS("../Data/otu_filt.RDS")
map <- readRDS("../Data/map.RDS")

# Subset and format
row.names(map) <- map$SampleID
otu <- otu[,match(map$SampleID, colnames(otu))]
```

Run DESeq and save the files
```{r}
dds <- DESeqDataSetFromMatrix(countData = otu,
                              colData = map,
                              design = ~ 1)

dds <- DESeq(dds)

vsd.blind <- varianceStabilizingTransformation(dds, blind = TRUE)

norm.blind <- assay(vsd.blind)
norm.count <- counts(dds, normalized = TRUE)

saveRDS(norm.blind, "../Data/otu_vsd_blind_alt.RDS")
saveRDS(norm.count, "../Data/otu_DESeqnorm.RDS")
```
